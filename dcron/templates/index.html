{% extends 'base.html' %}

{% block script %}
<script type="text/javascript">
    $(document).ready(function() {
        let updateTables = function() {
            $('#nodestable').load('/nodes');
            $('#jobstable').load('/jobs');
        };
        setInterval(updateTables, 1000);
    });

    function formVisibility() {
        let elem = document.getElementById("addcronform");
        if (elem.style.display === "none") {
            elem.style.display = "block";
        } else {
            elem.style.display = "none";
        }
    }

    function logVisibility() {
        let elem = document.getElementById("joblogdiv");
        if (elem.style.display === "none") {
            elem.style.display = "block";
        } else {
            elem.style.display = "none";
        }
    }
    function jobLog(elem) {
        let kve = $(elem).data("cmd").split(',');
        let request_data = {};
        for (let i = 0; i < kve.length; i++) {
            request_data[kve[i].split(':')[0]] = kve[i].split(':')[1];
        }
        $.ajax({
            url: '/joblog',
            data: request_data,
            type: 'POST',
            success: function (result) {
                console.log(result);
                $('#joblog').html(result);
                logVisibility();
            }
        });
    }
    function removeJob(elem) {
        let kve = $(elem).data("cmd").split(',');
        let request_data = {};
        for (let i = 0; i < kve.length; i++) {
            request_data[kve[i].split(':')[0]] = kve[i].split(':')[1];
        }
        $.ajax({
            url: '/remove_job',
            data: request_data,
            type: 'POST',
            success: function (result) {
                console.log(result);
            }
        });
    }
</script>
{% endblock %}

{% block title %}
dcron console
{% endblock %}

{% block content %}
<div id="nodestable">
</div>
<p>overview of active nodes</p>
<br/><br/>
<div id="jobstable">
</div>
<p>overview of active jobs</p>
<div align="center" style="display:none" id="joblogdiv">
    <div id="joblog"></div>
    <button id="hidejoblog" onclick="logVisibility();">close log</button>
</div>
<br/><br/>
<div align="center">
    <button id="addcron" onclick="formVisibility();">add cron job</button>
    <br/>
    <form id="addcronform" action="/job" method="post" name="addcronform" style="display:none" accept-charset="utf-8">
        <table>
            <tr>
                <td><label for="minute">Minute</label></td>
                <td><input id="minute" name="minute" value="*"/></td>
            </tr>
            <tr>
                <td><label for="hour">Hour</label></td>
                <td><input id="hour" name="hour" value="*"/></td>
            </tr>
            <tr>
                <td><label for="dayofmonth">Day of month</label></td>
                <td><input id="dayofmonth" name="dayofmonth" value="*"/></td>
            </tr>
            <tr>
                <td><label for="month">Month</label></td>
                <td><input id="month" name="month" value="*"/></td>
            </tr>
            <tr>
                <td><label for="dayofweek">Day of week</label></td>
                <td><input id="dayofweek" name="dayofweek" value="*"/></td>
            </tr>
            <tr>
                <td><label for="command">Command</label></td>
                <td><input id="command" name="command" /></td>
            </tr>
        </table>
        <br/>
         <div align="center">
             <button id="addjob" type="submit">submit new job</button>
        </div>
    </form>
</div>
{% endblock %}

{% block footer %}
<p>source available at <a href="https://github.com/witlox/dcron" target="_blank">github.com/witlox/dcron</a></p>
{% endblock %}